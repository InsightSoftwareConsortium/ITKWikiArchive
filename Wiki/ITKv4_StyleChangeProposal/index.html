<!DOCTYPE html>

<html class="client-nojs" dir="ltr" lang="en">
<head>
<meta charset="utf-8"/>
<title>ITKv4 StyleChangeProposal</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":false,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"928b086d070ca952f1d53cf4","wgCSPNonce":false,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"ITKv4_StyleChangeProposal","wgTitle":"ITKv4 StyleChangeProposal","wgCurRevisionId":29880,"wgRevisionId":29880,"wgArticleId":5638,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"ITKv4_StyleChangeProposal","wgRelevantArticleId":5638,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]};RLSTATE={"site.styles":"ready",
"user.styles":"ready","user":"ready","user.options":"loading","skins.monobook.styles":"ready"};RLPAGEMODULES=["site","mediawiki.page.ready","mediawiki.toc","skins.monobook.scripts"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1i9g4",function($,jQuery,require,module){mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});});});</script>
<link href="/Wiki/load.php?lang=en&amp;modules=skins.monobook.styles&amp;only=styles&amp;skin=monobook" rel="stylesheet"/>
<script async="" src="/Wiki/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=monobook"></script>
<meta content="" name="ResourceLoaderDynamicStyles"/>
<link href="/Wiki/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=monobook" rel="stylesheet"/>
<meta content="MediaWiki 1.38.6" name="generator"/>
<meta content="telephone=no" name="format-detection"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0" name="viewport"/>
<link href="/favicon.ico" rel="shortcut icon"/>
<link href="/Wiki/opensearch_desc.php" rel="search" title="KitwarePublic (en)" type="application/opensearchdescription+xml"/>
<link href="https://public.kitware.com/Wiki/api.php?action=rsd" rel="EditURI" type="application/rsd+xml"/>
<link href="https://creativecommons.org/licenses/by/2.5/" rel="license"/>
<link href="/Wiki/index.php?title=Special:RecentChanges&amp;feed=atom" rel="alternate" title="KitwarePublic Atom feed" type="application/atom+xml"/>
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-ITKv4_StyleChangeProposal rootpage-ITKv4_StyleChangeProposal skin-monobook action-view skin--responsive"><!-- start content -->
<div class="mw-body-content mw-content-ltr" dir="ltr" id="mw-content-text" lang="en"><div class="mw-parser-output"><div aria-labelledby="mw-toc-heading" class="toc" id="toc" role="navigation"><input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox"/><div class="toctitle" dir="ltr" lang="en"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Importance_of_consistent_style"><span class="tocnumber">1</span> <span class="toctext">Importance of consistent style</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Guidelines_for_changing_the_style"><span class="tocnumber">2</span> <span class="toctext">Guidelines for changing the style</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Current_Status"><span class="tocnumber">3</span> <span class="toctext">Current Status</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Proposal"><span class="tocnumber">4</span> <span class="toctext">Proposal</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Experience"><span class="tocnumber">5</span> <span class="toctext">Experience</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#How_to_run_uncrustify_in_ITK"><span class="tocnumber">5.1</span> <span class="toctext">How to run uncrustify in ITK</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Issues"><span class="tocnumber">5.2</span> <span class="toctext">Issues</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Proposed_CXX_File_for_Testing_KWStyle"><span class="tocnumber">6</span> <span class="toctext">Proposed CXX File for Testing KWStyle</span></a></li>
</ul>
</div>
<h2><span class="mw-headline" id="Importance_of_consistent_style">Importance of consistent style</span></h2>
<p>It is recognized that preferences in coding style varies widely from developer to developer.  It is, however, important that the entire ITK toolkit have a consistent well defined style so that the entire toolkit appears to have been written by a single developer.
</p>
<h2><span class="mw-headline" id="Guidelines_for_changing_the_style">Guidelines for changing the style</span></h2>
<ol><li><ol><li>Should be similar to the existing style</li>
<li>Changes from existing style should be driven to ease maintenance of the the consistent style</li>
<li>(Others)</li></ol></li></ol>
<h2><span class="mw-headline" id="Current_Status">Current Status</span></h2>
<ol><li><ol><li>The current style document was written 7 years ago and has not been updated since then, and is a great reference document, but contains some ambiguity/inconsistencies</li>
<li>The de-facto enforcement is that the code passes the KWStyle validation tester, and it appears that in at least one case (indentation) the KWStyle program is taking advantage of ambiguities in the style document to have different rules for indenting functions based on namespace and</li>
<li>function declarations are nested inside namespace and class levels, and are currently KWStyle requires that the braces have a 2 space indentation</li>
<li>function definitions are not nested inside the class level, and KWStyle requires that the braces are at column zero of the function</li>
<li>KWStyle has been given too much authority in dictating the style rather than just checking it.  We need to recognize that code that does not pass KWStyle may still be compliant with the standard, AND more importantly that making code pass KWStyle is in conflict with the guidelines.</li></ol></li></ol>
<h2><span class="mw-headline" id="Proposal">Proposal</span></h2>
<ol><li><ol><li>Rules should be as simple to follow as possible, with as few conditionals as possible  (i.e. all functions should have braces start  at either column 0 or column 2 irregardless of if it is a declaration or a definition, or if it is nested inside a class)</li>
<li>Rules should be compatible with automated reformatting utilities (uncrustify)</li>
<li>Rules should be at least partially compatible with a wide range of editors (vim, emacs, VS) autoformatting capabilities (This may require more extensive style changes to make this occur)</li>
<li>KWStyle should be updated to allow passing of the style.</li>
<li>CMakeLists.txt key words should use the lower case variant to match documentation.</li>
<li>CVS auto inserted KeyWords should be removed</li></ol></li></ol>
<pre>&gt;   Module:    $RCSfile: itkImageIOBase.h,v $
&gt;   Date:      $Date: 2009-11-29 15:51:11 $
&gt;   Version:   $Revision: 1.56 $
</pre>
<p><br/>
</p>
<h2><span class="mw-headline" id="Experience">Experience</span></h2>
<p>The <a class="external text" href="http://uncrustify.sourceforge.net/" rel="nofollow">uncrustify</a> configuration file (below) closely matches the KWStyle (except for the inconsistent function brace indentation).
</p>
<ul><li><a class="external free" href="http://www.itk.org/Wiki/images/6/62/Uncrustify_itk.txt" rel="nofollow">http://www.itk.org/Wiki/images/6/62/Uncrustify_itk.txt</a></li>
<li><a href="/Wiki/File:Uncrustify_itk.txt" title="File:Uncrustify itk.txt">File:Uncrustify itk.txt</a></li>
<li><a href="/Wiki/File:DoSingleKWStyleUncrustifyFix.sh.txt" title="File:DoSingleKWStyleUncrustifyFix.sh.txt">File:DoSingleKWStyleUncrustifyFix.sh.txt</a></li></ul>
<pre>

See attached file that needs to be renamed with .sh extension
</pre>
<h3><span class="mw-headline" id="How_to_run_uncrustify_in_ITK">How to run uncrustify in ITK</span></h3>
<pre> ${UNCRUSTIFYBIN} -c ${LOCAL_DIR}/uncrustify_itk.txt -l CPP -f ${ORIG} -o ${i}.temp
</pre>
<h3><span class="mw-headline" id="Issues">Issues</span></h3>
<ol><li>In deeply  nested large macros (like those in itkMacro.h), It sometimes gets confused, and adds spaces around “##” and “#” symbols that are supposed to be string replacements in the macro.
<ul><li>Hans have fixed this with a little “sed” magic in the script referenced from the wiki page.</li></ul></li>
<li>For end of line comments that begin after the 80th column, sometime multiple runs of uncrustify will create extraneous blank comment lines aligned with the previous comment lines (so that running uncrustify 100 times would result in a 100 empty comment lines aligned with the original comment.</li>
<li>When the declaration of static const arrays or structures occurs where the definition of the variables are within #ifdefs and the initialization {} are outside the ifdefs, then uncrustify thinks that the ; at the end of the initializing {} is extraneous, and removes i</li></ol>
<h2><span class="mw-headline" id="Proposed_CXX_File_for_Testing_KWStyle">Proposed CXX File for Testing KWStyle</span></h2>
<pre>//                                                                              
// new way; should pass                                                         
void Function()
{
  int i;
}

class C
{
public:
  void ClassMethod()
  { // new 2; old 4                                                             
    int i;
  } // new 2; old 4                                                             
};

void FunctionWithLocalClass()
{
  class LocalClass
  { // new 2; old 4                                                             
  public:
    void LocalClassMethod()
    { // new 4; old 6                                                           
      int i;
    } // new 4; old 6                                                           
  }; // new 2; old 4                                                            
}

//                                                                              
// old way; should fail                                                         
void Function()
{
  int i;
}

class C
{
public:
  void ClassMethod()
    { // new 2; old 4                                                           
    int i;
    } // new 2; old 4                                                           
};

void FunctionWithLocalClass()
{
  class LocalClass
    { // new 2; old 4                                                           
  public:
      void LocalClassMethod()
      { // new 4; old 6                                                         
      int i;
      } // new 4; old 6                                                         
    }; // new 2; old 4                                                          
}
</pre>
<ul><li>CMakeLists.txt Style</li></ul>
<p>Recent versions of cmake documentation have gone to using all lower case key words.  In order to make ITKv4 consistent with the printed documentation, ITKv4 should also follow this convention.
</p><p>This vim macro accomplishes the task easily, and has been tested on the BRAINS source code base.
</p>
<pre>:%s!ADD_CUSTOM_COMMAND\( *\)(!add_custom_command\2(!g
:%s!ADD_CUSTOM_TARGET\( *\)(!add_custom_target\2(!g
:%s!ADD_DEFINITIONS\( *\)(!add_definitions\2(!g
:%s!ADD_DEPENDENCIES\( *\)(!add_dependencies\2(!g
:%s!ADD_EXECUTABLE\( *\)(!add_executable\2(!g
:%s!ADD_LIBRARY\( *\)(!add_library\2(!g
:%s!ADD_SUBDIRECTORY\( *\)(!add_subdirectory\2(!g
:%s!subdirs\( *\)(!add_subdirectory\2(!g
:%s!SUBDIRS\( *\)(!add_subdirectory\2(!g
:%s!ADD_TEST\( *\)(!add_test\2(!g
:%s!AUX_SOURCE_DIRECTORY\( *\)(!aux_source_directory\2(!g
:%s!BREAK\( *\)(!break\2(!g
:%s!BUILD_COMMAND\( *\)(!build_command\2(!g
:%s!CMAKE_MINIMUM_REQUIRED\( *\)(!cmake_minimum_required\2(!g
:%s!CMAKE_POLICY\( *\)(!cmake_policy\2(!g
:%s!CONFIGURE_FILE\( *\)(!configure_file\2(!g
:%s!CREATE_TEST_SOURCELIST\( *\)(!create_test_sourcelist\2(!g
:%s!DEFINE_PROPERTY\( *\)(!define_property\2(!g
:%s!ELSE\( *\)(!else\2(!g
:%s!ELSEIF\( *\)(!elseif\2(!g
:%s!ENABLE_LANGUAGE\( *\)(!enable_language\2(!g
:%s!ENABLE_TESTING\( *\)(!enable_testing\2(!g
:%s!ENDFOREACH\( *\)(!endforeach\2(!g
:%s!ENDFUNCTION\( *\)(!endfunction\2(!g
:%s!ENDIF\( *\)(!endif\2(!g
:%s!ENDMACRO\( *\)(!endmacro\2(!g
:%s!ENDWHILE\( *\)(!endwhile\2(!g
:%s!EXECUTE_PROCESS\( *\)(!execute_process\2(!g
:%s!EXPORT\( *\)(!export\2(!g
:%s!FILE\( *\)(!file\2(!g
:%s!FIND_FILE\( *\)(!find_file\2(!g
:%s!FIND_LIBRARY\( *\)(!find_library\2(!g
:%s!FIND_PACKAGE\( *\)(!find_package\2(!g
:%s!FIND_PATH\( *\)(!find_path\2(!g
:%s!FIND_PROGRAM\( *\)(!find_program\2(!g
:%s!FLTK_WRAP_UI\( *\)(!fltk_wrap_ui\2(!g
:%s!FOREACH\( *\)(!foreach\2(!g
:%s!FUNCTION\( *\)(!function\2(!g
:%s!GET_CMAKE_PROPERTY\( *\)(!get_cmake_property\2(!g
:%s!GET_DIRECTORY_PROPERTY\( *\)(!get_directory_property\2(!g
:%s!GET_FILENAME_COMPONENT\( *\)(!get_filename_component\2(!g
:%s!GET_PROPERTY\( *\)(!get_property\2(!g
:%s!GET_SOURCE_FILE_PROPERTY\( *\)(!get_source_file_property\2(!g
:%s!GET_TARGET_PROPERTY\( *\)(!get_target_property\2(!g
:%s!GET_TEST_PROPERTY\( *\)(!get_test_property\2(!g
:%s!IF\( *\)(!if\2(!g
:%s!INCLUDE\( *\)(!include\2(!g
:%s!INCLUDE_DIRECTORIES\( *\)(!include_directories\2(!g
:%s!INCLUDE_EXTERNAL_MSPROJECT\( *\)(!include_external_msproject\2(!g
:%s!INCLUDE_REGULAR_EXPRESSION\( *\)(!include_regular_expression\2(!g
:%s!INSTALL\( *\)(!install\2(!g
:%s!LINK_DIRECTORIES\( *\)(!link_directories\2(!g
:%s!LIST\( *\)(!list\2(!g
:%s!LOAD_CACHE\( *\)(!load_cache\2(!g
:%s!LOAD_COMMAND\( *\)(!load_command\2(!g
:%s!MACRO\( *\)(!macro\2(!g
:%s!MARK_AS_ADVANCED\( *\)(!mark_as_advanced\2(!g
:%s!MATH\( *\)(!math\2(!g
:%s!MESSAGE\( *\)(!message\2(!g
:%s!OPTION\( *\)(!option\2(!g
:%s!OUTPUT_REQUIRED_FILES\( *\)(!output_required_files\2(!g
:%s!PROJECT\( *\)(!project\2(!g
:%s!QT_WRAP_CPP\( *\)(!qt_wrap_cpp\2(!g
:%s!QT_WRAP_UI\( *\)(!qt_wrap_ui\2(!g
:%s!REMOVE_DEFINITIONS\( *\)(!remove_definitions\2(!g
:%s!RETURN\( *\)(!return\2(!g
:%s!SEPARATE_ARGUMENTS\( *\)(!separate_arguments\2(!g
:%s!SET\( *\)(!set\2(!g
:%s!SET_DIRECTORY_PROPERTIES\( *\)(!set_directory_properties\2(!g
:%s!SET_PROPERTY\( *\)(!set_property\2(!g
:%s!SET_SOURCE_FILES_PROPERTIES\( *\)(!set_source_files_properties\2(!g
:%s!SET_TARGET_PROPERTIES\( *\)(!set_target_properties\2(!g
:%s!SET_TESTS_PROPERTIES\( *\)(!set_tests_properties\2(!g
:%s!SITE_NAME\( *\)(!site_name\2(!g
:%s!SOURCE_GROUP\( *\)(!source_group\2(!g
:%s!STRING\( *\)(!string\2(!g
:%s!TARGET_LINK_LIBRARIES\( *\)(!target_link_libraries\2(!g
:%s!TRY_COMPILE\( *\)(!try_compile\2(!g
:%s!TRY_RUN\( *\)(!try_run\2(!g
:%s!UNSET\( *\)(!unset\2(!g
:%s!VARIABLE_WATCH\( *\)(!variable_watch\2(!g
:%s!WHILE\( *\)(!while\2(!g
:%s!BUILD_NAME\( *\)(!build_name\2(!g
:%s!EXEC_PROGRAM\( *\)(!exec_program\2(!g
:%s!EXPORT_LIBRARY_DEPENDENCIES\( *\)(!export_library_dependencies\2(!g
:%s!INSTALL_FILES\( *\)(!install_files\2(!g
:%s!INSTALL_PROGRAMS\( *\)(!install_programs\2(!g
:%s!INSTALL_TARGETS\( *\)(!install_targets\2(!g
:%s!LINK_LIBRARIES\( *\)(!link_libraries\2(!g
:%s!MAKE_DIRECTORY\( *\)(!make_directory\2(!g
:%s!REMOVE\( *\)(!remove\2(!g
:%s!SUBDIR_DEPENDS\( *\)(!subdir_depends\2(!g
:%s!SUBDIRS\( *\)(!subdirs\2(!g
:%s!USE_MANGLED_MESA\( *\)(!use_mangled_mesa\2(!g
:%s!UTILITY_SOURCE\( *\)(!utility_source\2(!g
:%s!VARIABLE_REQUIRES\( *\)(!variable_requires\2(!g
:%s!WRITE_FILE\( *\)(!write_file\2(!g
</pre>
<!-- 
NewPP limit report
Cached time: 20250111153844
Cache expiry: 86400
Reduced expiry: false
Complications: []
CPU time usage: 0.009 seconds
Real time usage: 0.011 seconds
Preprocessor visited node count: 41/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/100
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 6148/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
<!-- Saved in parser cache with key KitwarePublicWikiDB:pcache:idhash:5638-0!canonical and timestamp 20250111153844 and revision id 29880. Serialized with JSON.
 -->
</div>
</div>

<!-- end content --></body>
</html>