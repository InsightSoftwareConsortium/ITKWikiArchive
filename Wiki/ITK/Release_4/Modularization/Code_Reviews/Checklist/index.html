<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8"/>
<title>ITK/Release 4/Modularization/Code Reviews/Checklist - KitwarePublic</title>
<script>document.documentElement.className="client-js";RLCONF={"wgBreakFrames":!1,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"0ea632f7ca1bb26d1afb3aaf","wgCSPNonce":!1,"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"ITK/Release_4/Modularization/Code_Reviews/Checklist","wgTitle":"ITK/Release 4/Modularization/Code Reviews/Checklist","wgCurRevisionId":51385,"wgRevisionId":51385,"wgArticleId":8863,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["ITK"],"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"ITK/Release_4/Modularization/Code_Reviews/Checklist","wgRelevantArticleId":8863,"wgIsProbablyEditable":!1,"wgRelevantPageIsProbablyEditable":!1,
"wgRestrictionEdit":[],"wgRestrictionMove":[]};RLSTATE={"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","skins.monobook.styles":"ready"};RLPAGEMODULES=["site","mediawiki.page.ready","mediawiki.toc","skins.monobook.scripts"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.implement("user.options@1hzgi",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});});</script>
<link rel="stylesheet" href="/Wiki/load.php?lang=en&amp;modules=skins.monobook.styles&amp;only=styles&amp;skin=monobook"/>
<script async="" src="/Wiki/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=monobook"></script>
<meta name="ResourceLoaderDynamicStyles" content=""/>
<link rel="stylesheet" href="/Wiki/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=monobook"/>
<meta name="generator" content="MediaWiki 1.37.1"/>
<meta name="format-detection" content="telephone=no"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.25, maximum-scale=5.0"/>
<link rel="shortcut icon" href="/favicon.ico"/>
<link rel="search" type="application/opensearchdescription+xml" href="/Wiki/opensearch_desc.php" title="KitwarePublic (en)"/>
<link rel="EditURI" type="application/rsd+xml" href="https://public.kitware.com/Wiki/api.php?action=rsd"/>
<link rel="license" href="https://creativecommons.org/licenses/by/2.5/"/>
<link rel="alternate" type="application/atom+xml" title="KitwarePublic Atom feed" href="/Wiki/index.php?title=Special:RecentChanges&amp;feed=atom"/>
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-ITK_Release_4_Modularization_Code_Reviews_Checklist rootpage-ITK skin-monobook action-view skin--responsive"><!-- start content -->
				<div id="mw-content-text" class="mw-body-content mw-content-ltr" lang="en" dir="ltr"><div class="mw-parser-output"><p>This page defines the check list to be used by reviewers during the process of reviewing the files in ITKv4.
</p>
<div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Major_Topics"><span class="tocnumber">1</span> <span class="toctext">Major Topics</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Coding_Style"><span class="tocnumber">2</span> <span class="toctext">Coding Style</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Running_KWStyle"><span class="tocnumber">2.1</span> <span class="toctext">Running KWStyle</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#In_a_single_file"><span class="tocnumber">2.1.1</span> <span class="toctext">In a single file</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#In_all_the_repository"><span class="tocnumber">2.1.2</span> <span class="toctext">In all the repository</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-6"><a href="#Const_Correctness"><span class="tocnumber">3</span> <span class="toctext">Const Correctness</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Mini-Pipelines"><span class="tocnumber">4</span> <span class="toctext">Mini-Pipelines</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Region_Management"><span class="tocnumber">5</span> <span class="toctext">Region Management</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Streaming"><span class="tocnumber">6</span> <span class="toctext">Streaming</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Progress_Reporting"><span class="tocnumber">7</span> <span class="toctext">Progress Reporting</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#Multi-Threading"><span class="tocnumber">8</span> <span class="toctext">Multi-Threading</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Example"><span class="tocnumber">8.1</span> <span class="toctext">Example</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#Member_Variables"><span class="tocnumber">9</span> <span class="toctext">Member Variables</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#Notes"><span class="tocnumber">10</span> <span class="toctext">Notes</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Major_Topics">Major Topics</span></h1>
<p>The reviewer will verify the file for compliance with the following major topics
</p>
<ul><li>Coding Style</li>
<li>Const correctness</li>
<li>Mini-Pipelines</li>
<li>Progress Reporting</li>
<li>Multi-Threading</li>
<li>Member variables holding to memory</li></ul>
<p>The following sections specify the details to be evaluated with each one of these major topics.
</p>
<h1><span class="mw-headline" id="Coding_Style">Coding Style</span></h1>
<p>Despite the fact that coding style is verified regularly with KStyle, there are still many details that escape that verification. The following list specifies what elements must be verified by the reviewer.
</p>
<ul><li>Filename must match class name</li>
<li>Files must contain a single class</li>
<li>Implementation of methods must be in the .hxx or .cxx files, not the .h files</li>
<li>All files must have the <a href="/Wiki/ITK_Copyright_Header" class="mw-redirect" title="ITK Copyright Header">Copyright Header</a> at the top.</li>
<li>#define for class name in the .h and .hxx files. __classname_h and __classname_hxx</li>
<li>Doxygen documentation
<ul><li>Brief class doxygen description</li>
<li>Complete class doxygen description</li>
<li>make sure there is: \ingroup ITKModuleName (ModuleName matching the module it belongs, else ModuleInDoxygenGroup will fail)</li></ul></li>
<li>namespace itk</li>
<li>Classes that use SmartPointers must have
<ul><li>Constructor/Destructor protected</li>
<li>Copy Constructor&#160;: private and not implemented</li>
<li>Operator=&#160;: private and not implemented</li></ul></li>
<li>No acronyms in class name or method names</li>
<li>No unnecessary headers #included</li>
<li>Justify every public method</li>
<li>All member variables must be private</li>
<li>Use Set/Get Macros (macros should call Modified() to ensure pipeline data is updated)</li>
<li>If deriving from itkObject
<ul><li>Use New macro</li>
<li>declare SmartPointer&lt;T&gt; as Pointer</li>
<li>declare SmartPointer&lt;const T&gt; as ConstPointer</li>
<li>declare Self</li>
<li>declare Superclass</li>
<li>use TypeMacro</li>
<li>Have PrintSelf() method and print all the member variables</li></ul></li>
<li>100% code coverage
<ul><li>Run Utilities/Maintenance/computeCodeCoverageLocallyForOneTest.sh</li>
<li>Check dashboard</li></ul></li>
<li>Any information that is printed or displayed has to be legible to human eyes</li>
<li>Respect Coding Style as specified in the document Insight/Documentation/Style.pdf</li>
<li>Must pass the test of KWStyle</li>
<li>[Style] In the .hxx files of template classes, the first 5 lines in the declaration of methods should be:
<ul><li>1) template</li>
<li>2) return type</li>
<li>3) class name</li>
<li>4)&#160;::method name</li>
<li>5) the opening bracket</li></ul></li></ul>
<p>For example:
</p>
<pre> template &lt;  template_arguments &gt;
 return_type
 classname&lt; template_arguments &gt;
&#160;::methodsName( method_arguments )
 {
   // indentation of two spaces
   // for the first line of code
   int k = 0;
 }
</pre>
<p>In many cases line (2) uses a trait from the templated class and therefore becomes:
</p>
<pre> typename classname&lt; template_arguments &gt;::trait
</pre>
<h2><span class="mw-headline" id="Running_KWStyle">Running KWStyle</span></h2>
<h3><span class="mw-headline" id="In_a_single_file">In a single file</span></h3>
<pre>  KWStyle -xml ITK.kws.xml itkQuadEdgeMeshTest1.cxx -v
</pre>
<h3><span class="mw-headline" id="In_all_the_repository">In all the repository</span></h3>
<pre>  make StyleCheck
</pre>
<h1><span class="mw-headline" id="Const_Correctness">Const Correctness</span></h1>
<ul><li>Get method must be const</li>
<li>SetInput methods must take "const raw pointers" as input</li>
<li>GetOutput methods must give const raw pointers as output</li>
<li>All non-trivial types must be passed by reference (except for DataObjects, that must be passed by const raw pointers).</li>
<li>const_cast must only be used inside of the SetInput() method, to overcome the lack of const-correctness in the pipeline.
<ul><li>overriding GenerateInputRequestedRegion requires const_cast on the inputs</li>
<li>any other uses of const_cast must be scrutinized</li></ul></li></ul>
<h1><span class="mw-headline" id="Mini-Pipelines">Mini-Pipelines</span></h1>
<p>Filters that implement a mini-pipeline with N internal filters should
</p>
<ul><li>Examine that this method is consistent with all filters in mini-pipeline:</li></ul>
<pre>  void EnlargeOutputRequestedRegion(DataObject *output)
</pre>
<ul><li>Call ReleaseDataFlagOn() in the first N-1 filters of its mini-pipeline</li>
<li>For the filters that can run in-place, set them to do so by calling InPlaceOn(). Except the first filter.</li>
<li>Use the ProgressAccumulator in order to compose a progress report from each one of the internal filters</li>
<li>Use GraftOutput() in the following way at the end of the GenerateData() method</li></ul>
<pre> caster-&gt;GraftOutput( outputImage );
 caster-&gt;Update();
 this-&gt;GraftOutput( caster-&gt;GetOutput() );
</pre>
<h1><span class="mw-headline" id="Region_Management">Region Management</span></h1>
<p>All Filters (supporting streaming or not)
</p>
<ul><li>In their GenerateData() method they should:
<ul><li>Only process the Requested Region of the output</li>
<li>Never access more than the Buffered region of the input</li></ul></li></ul>
<p><br />
If a filter does not support streaming it should:
</p>
<ul><li>Override EnlargeOuputRequestedRegion, and call SetRequestedRegionToLargestPossibleRegion on it's input</li>
<li>It does not need to override the GenerateInputRequestedRegion
<ul><li>unless the filter is manipulating the size, or geometry</li></ul></li></ul>
<h1><span class="mw-headline" id="Streaming">Streaming</span></h1>
<p>Filters that are intended for supporting streaming must consider that:
</p>
<ul><li>The RequestedRegion can be smaller than the LargestPossibleRegion.</li></ul>
<p>As such, the boundary of the output BufferedRegion may not be a boundary condition and thus the filter writer must implement GenerateInputRequestedRegion to ensure that any pixels outside the output BufferedRegion that are within the LargestPossibleRegion that are needed for proper computation are added to the input RequestedRegion.
</p>
<h1><span class="mw-headline" id="Progress_Reporting">Progress Reporting</span></h1>
<p>Filter should report 
</p>
<ul><li>ProgressEvents or</li>
<li>IterationEvents</li></ul>
<p>If they report ProgressEvents, they should use the ProgressReporter class as
</p>
<pre>   ProgressReporter progress( this, threadId, outputRegionForThread.GetNumberOfPixels() );
   
   while( ... )
     {
     // do stuff
     progress.CompletedPixel();
     }
</pre>
<p>If the filter implements a mini-pipeline, then the progress reporting should be done using the ProgressAccumulator inside the GenerateData() method as:
</p>
<pre> ProgressAccumulator::Pointer progress = ProgressAccumulator::New();
 progress-&gt;SetMiniPipelineFilter(this);
 
 progress-&gt;RegisterInternalFilter( internalFilter01, fraction1 );
 progress-&gt;RegisterInternalFilter( internalFilter02, fraction2 );
 progress-&gt;RegisterInternalFilter( internalFilter03, fraction3 );
 progress-&gt;RegisterInternalFilter( internalFilter04, fraction4 );
</pre>
<p><br />
where internalFilterX is each one of the filters in the mini-pipeline, and fractionX are number that add up to 1.0, and represent the fraction of time that each one of the filters will contribute to the total computation. This fraction is assigned as an estimation, and doesn't have to be perfect, just aim for the correct order of magnitude.
</p><p><br />
</p>
<h1><span class="mw-headline" id="Multi-Threading">Multi-Threading</span></h1>
<p>Filters that are multi-threaded, must implement the method:
</p>
<pre>  void ThreadedGenerateData(
     const OutputImageRegionType &amp; outputRegionForThread,
     ThreadIdType threadId)
</pre>
<p>and can (but do not have to) implement the methods
</p>
<pre>   void BeforeThreadedGenerateData()
   void AfterThreadedGenerateData()
</pre>
<p>These two methods are intended to implement the preparation of variables that host computations on every thread, and to consolidate that information once the threads have completed their work.
</p><p>The filter should not implement the GenerateData() method, unless it needs anything different from what is provided in the default method in
</p>
<pre>     ImageSource::GenerateData()
</pre>
<p>that essentially does:
</p>
<pre>  void GenerateData()
  {
  this-&gt;AllocateOutputs();
  this-&gt;BeforeThreadedGenerateData();
  
  ThreadStruct str;
  str.Filter = this;
  
  this-&gt;GetMultiThreader()-&gt;SetNumberOfThreads( this-&gt;GetNumberOfThreads() );
  this-&gt;GetMultiThreader()-&gt;SetSingleMethod(this-&gt;ThreaderCallback, &amp;str);
  
  this-&gt;GetMultiThreader()-&gt;SingleMethodExecute();
  
  this-&gt;AfterThreadedGenerateData();
  }
</pre>
<p>Any variables that need to be written into during the execution of the ThreadedGenerateData() method, must be put into an array, to provide an independent instance to every thread. This preparation can be done in the BeforeThreadedGenerateData() method, and the consolidation of values in the arrays can be done in the AfterThreadedGenerateData() method.
</p>
<h2><span class="mw-headline" id="Example">Example</span></h2>
<p>For an example, look at the classes
</p>
<ul><li>itkStatisticsImageFilter</li>
<li>itkUnaryFunctorFilter</li></ul>
<h1><span class="mw-headline" id="Member_Variables">Member Variables</span></h1>
<p>Filters should not use member variables to hold to their inputs or outputs.
</p><p>The inputs and outputs should be maintained by the methods
</p>
<pre>   SetInput(const InputImageType *input)
     {
     this-&gt;ProcessObject::SetNthInput( 0,const_cast&lt; InputImageType * &gt;( input ) );
     }
</pre>
<p><br />
</p>
<pre>  GetInput( unsigned int idx ) 
    {
    return static_cast&lt; const TInputImage * &gt;( this-&gt;ProcessObject::GetInput(idx) );
    }
</pre>
<p><br />
</p>
<pre>  GetOutput()
    {
    if ( this-&gt;GetNumberOfOutputs() &lt; 1 )
      {
      return 0;
      }
    
    return static_cast&lt; TOutputImage * &gt;( this-&gt;ProcessObject::GetOutput(0) );
    }
</pre>
<p><br />
In most cases, these methods are already provided by super classes. In particular by
</p>
<pre>  * itk::ImageSource
  * itk::ImageToImageFilter
</pre>
<p><br />
</p>
<h1><span class="mw-headline" id="Notes">Notes</span></h1>
<p><br />
</p>
<hr />
<table width="100%" border="0" cellspacing="0" cellpadding="0">

<tbody><tr>
<td bgcolor="#F9F9F9"><center><small>ITK: &#91;<a href="/Wiki/ITK" title="ITK">Welcome</a> | <a href="/Wiki/Category:ITK" title="Category:ITK">Site Map</a>&#93;</small></center>
</td></tr></tbody></table>
<!-- 
NewPP limit report
Cached time: 20220127082452
Cache expiry: 86400
Reduced expiry: false
Complications: []
CPU time usage: 0.029 seconds
Real time usage: 0.029 seconds
Preprocessor visited node count: 47/1000000
Post‐expand include size: 222/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 0/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    4.442      1 -total
100.00%    4.442      1 Template:ITK/Template/Footer
 34.80%    1.546      1 Template:ITK/Template/Categories
-->

<!-- Saved in parser cache with key KitwarePublicWikiDB:pcache:idhash:8863-0!canonical and timestamp 20220127082452 and revision id 51385. Serialized with JSON.
 -->
</div>
<div class="printfooter">Retrieved from "<a dir="ltr" href="https://public.kitware.com/Wiki/index.php?title=ITK/Release_4/Modularization/Code_Reviews/Checklist&amp;oldid=51385">https://public.kitware.com/Wiki/index.php?title=ITK/Release_4/Modularization/Code_Reviews/Checklist&amp;oldid=51385</a>"</div></div>
				<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/Wiki/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/Wiki/Category:ITK" title="Category:ITK">ITK</a></li></ul></div></div>
				<!-- end content --></body></html>