
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" dir="ltr">
<head>
<title>ITK Release 4.0 Orientation by Torsten - KitwarePublic</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="MediaWiki 1.16.0" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/Wiki/opensearch_desc.php" title="KitwarePublic (en)" />
<link title="Creative Commons" type="application/rdf+xml" href="/Wiki/index.php?title=ITK_Release_4.0_Orientation_by_Torsten&amp;action=creativecommons" rel="meta" />
<link rel="copyright" href="http://creativecommons.org/licenses/by/2.5/" />
<link rel="alternate" type="application/atom+xml" title="KitwarePublic Atom feed" href="/Wiki/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="/Wiki/skins/common/shared.css?270" media="screen" />
<link rel="stylesheet" href="/Wiki/skins/common/commonPrint.css?270" media="print" />
<link rel="stylesheet" href="/Wiki/skins/monobook/main.css?270" media="screen" />
<!--[if lt IE 5.5000]><link rel="stylesheet" href="/Wiki/skins/monobook/IE50Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 5.5000]><link rel="stylesheet" href="/Wiki/skins/monobook/IE55Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" href="/Wiki/skins/monobook/IE60Fixes.css?270" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/Wiki/skins/monobook/IE70Fixes.css?270" media="screen" /><![endif]-->
<link rel="stylesheet" href="/Wiki/index.php?title=MediaWiki:Common.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="/Wiki/index.php?title=MediaWiki:Print.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" media="print" />
<link rel="stylesheet" href="/Wiki/index.php?title=MediaWiki:Monobook.css&amp;usemsgcache=yes&amp;ctype=text%2Fcss&amp;smaxage=18000&amp;action=raw&amp;maxage=18000" />
<link rel="stylesheet" href="/Wiki/index.php?title=-&amp;action=raw&amp;maxage=18000&amp;gen=css" />
<script>
var skin="monobook",
stylepath="/Wiki/skins",
wgUrlProtocols="http\\:\\/\\/|https\\:\\/\\/|ftp\\:\\/\\/|irc\\:\\/\\/|gopher\\:\\/\\/|telnet\\:\\/\\/|nntp\\:\\/\\/|worldwind\\:\\/\\/|mailto\\:|news\\:|svn\\:\\/\\/",
wgArticlePath="/Wiki/$1",
wgScriptPath="/Wiki",
wgScriptExtension=".php",
wgScript="/Wiki/index.php",
wgVariantArticlePath=false,
wgActionPaths={},
wgServer="http://www.itk.org",
wgCanonicalNamespace="",
wgCanonicalSpecialPageName=false,
wgNamespaceNumber=0,
wgPageName="ITK_Release_4.0_Orientation_by_Torsten",
wgTitle="ITK Release 4.0 Orientation by Torsten",
wgAction="view",
wgArticleId=3213,
wgIsArticle=true,
wgUserName=null,
wgUserGroups=null,
wgUserLanguage="en",
wgContentLanguage="en",
wgBreakFrames=false,
wgCurRevisionId=12819,
wgVersion="1.16.0",
wgEnableAPI=true,
wgEnableWriteAPI=true,
wgSeparatorTransformTable=["", ""],
wgDigitTransformTable=["", ""],
wgMainPageTitle="Main Page",
wgFormattedNamespaces={"-2": "Media", "-1": "Special", "0": "", "1": "Talk", "2": "User", "3": "User talk", "4": "KitwarePublic", "5": "KitwarePublic talk", "6": "File", "7": "File talk", "8": "MediaWiki", "9": "MediaWiki talk", "10": "Template", "11": "Template talk", "12": "Help", "13": "Help talk", "14": "Category", "15": "Category talk", "100": "Projects/ParaViewWeb", "101": "Projects/ParaViewWeb Talk", "102": "Projects/VTKWeb", "103": "Projects/VTKWeb Talk"},
wgNamespaceIds={"media": -2, "special": -1, "": 0, "talk": 1, "user": 2, "user_talk": 3, "kitwarepublic": 4, "kitwarepublic_talk": 5, "file": 6, "file_talk": 7, "mediawiki": 8, "mediawiki_talk": 9, "template": 10, "template_talk": 11, "help": 12, "help_talk": 13, "category": 14, "category_talk": 15, "projects/paraviewweb": 100, "projects/paraviewweb_talk": 101, "projects/vtkweb": 102, "projects/vtkweb_talk": 103, "image": 6, "image_talk": 7},
wgSiteName="KitwarePublic",
wgCategories=[],
wgRestrictionEdit=[],
wgRestrictionMove=[];
</script><script src="/Wiki/skins/common/wikibits.js?270"></script>
<script src="/Wiki/skins/common/ajax.js?270"></script>
<script src="/Wiki/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobook&amp;270"></script>

</head>
<body class="mediawiki ltr ns-0 ns-subject page-ITK_Release_4_0_Orientation_by_Torsten skin-monobook"><!-- start content -->
<pre>
While I won't claim I fully understand the current status quo in ITK, I
have a comment regarding Kent's list of options:
&gt; There's three concepts that collide when it comes to orientation. In order
&gt; to form a more perfect ITK, need to be considered.
&gt;
&gt; 1. Gross anatomical orientation -- you want to compare two volumes, one
&gt; acquired head first, and another feet first.  This is addressed by
&gt; * itk::SpatialOrientation (defines all 48 possible orientations)
&gt; * itk::SpatialOrientationAdapter (converts between spatial oriention codes
&gt; and direction cosines)
&gt; * Direction cosines (orientation info recovered from image files is
&gt; converted and stored therein)
&gt;
&gt; 2. Actual orientation ‹ the orientation info recovered can be from oblique
&gt; scans and it is stored in direction cosines.  This conflicts (somewhat) with
&gt; concept #1, in that going from the actual orientation to the gross
&gt; anatomical orientation squares up the direction cosines and loses the
&gt; rotational information.
&gt;
&gt; 3. General spatial transforms, addressed by itk::Transform and it¹s
&gt; children.  These are what are used by Registration and SpatialObjects to
&gt; move anatomy or geometry around.
&gt;
&gt;
For what it's worth, I recently had to reconcile options #1 and #2 in my
own library, and I thought I'd share my experience. To be very clear:
what I am going to say relates ONLY to my own software, which is
completely separate from ITK.

Historically, I have been following Option #1 above, then added Option
#2 for non-human images (bees don't live in RAS etc. space), but
recently needed to support direction cosines also for human data (from
DICOM). Obviously, I didn't want to break compatibility with
registrations computed over the past 10 years, so it was important to
come up with an implementation that achieves that.

So here's what I did, based on the space abstraction laid out by Gordon
Kindlman in the Nrrd file format specification.

All images are read living in some physical space. For DICOM, that's
LPS. For Nrrd, it's what's in the Nrrd &quot;space:&quot; field. For Analyze, it's
whatever the Analyze orientation field is supposed to mean in my reading
of the file format documentation.

My software uses RAS coordinates for all images internally.
Historically, everything was reoriented into RAS, i.e., for (i,j,k)
pixel index, i after reorientation increases from L to R.

Now -- here's the workflow when I read an image:

1. image data is read as stored in file, and coordinate space is set as
described above. Direction cosines are taken from input if they exist
(DICOM, Nrrd), or initialized as identity matrix (Analyze). Basically,
for the Analyze case, I am faking the anatomical orientation to be
identical to the space definition.

2. coordinate space is changed to RAS. That does not affect the storage
order of image pixels, but it changes the direction cosines by
permutation and negation. As an example, &quot;LPS&quot; to &quot;RAS&quot; means x becomes
-x, y becomes -y, and z stays z. This also applies to the coordinate
space origin. Different example: &quot;ARS&quot; to &quot;RAS&quot; means that x and
y elements are swapped in all direction vectors and also in the space
origin.

3. determine coarse anatomical orientation of image from direction
vectors and coordinate space (the latter now RAS). Based on this,
reorient image so that pixel storage is (i,j,k)&lt;=&gt;(L/R,P/A,I/S).
Direction cosines and space origin are modified accordingly so that the
every pixel remains in the same physical position. That means
permutation of direction vectors, negation of direction vectors plus
adding offset to space origin that corresponds to opposite end of image
w.r.t. given index.

After these steps, the image lives in RAS space, is coaresly stored in
RAS order, but has the same physical space coordinates for each pixel as
was stored in the original image file, i.e., all physical space
transformations between two images remain correct (when taking into
consideration that space axes may have been negated in step 2.

When images are written to a file, the procedure is repeated in reverse
order. For that, each image object has meta information that stores its
original coordinate space and storage order, so the original order and
space can be recovered. The original direction cosines are also
recovered in the process.

I am not saying this whole, slightly messy, procedure would be a good
idea for ITK, but it seems to reconcile Options #1 and #2 on Kent's
list, and it's working for me.

Best,
 Torsten
</pre>

<!-- 
NewPP limit report
Preprocessor node count: 4/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key KitwarePublicWikiDB:pcache:idhash:3213-0!1!0!!en!2!edit=0 and timestamp 20100921222509 -->
<div class="printfooter">
Retrieved from "<a href="http://www.itk.org/Wiki/ITK_Release_4.0_Orientation_by_Torsten">http://www.itk.org/Wiki/ITK_Release_4.0_Orientation_by_Torsten</a>"</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content --></body></html>
